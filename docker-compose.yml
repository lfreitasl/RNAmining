version: "3.4"

services:

    nginx_metavolcano:
        build: ./build/nginx
        ports:
            - "80:80"
        container_name: metavolcano_webserver
        volumes:
            - ./volumes/metavolcano-front:${DOCUMENT_ROOT}
        depends_on:
             - php_metavolcano
        networks:
                #- gatewayapps_proxy
            - php
        restart: always

    php_metavolcano:
        build: ./build/php
        container_name: metavolcano_php
        volumes:
                #            - ./.git/modules/volumes/metavolcano-front:/var/.git/modules/volumes/metavolcano-front
            - ./volumes/metavolcano-front:${DOCUMENT_ROOT}
        networks:
             - php
        environment:
             - REPOSITORY=${REPOSITORY}
             - BRANCH_STABLE=${BRANCH_STABLE}
             - TOKEN=${TOKEN}
        restart: always
        #command: /bin/bash -c "envsubst '$${REPOSITORY} $${BRANCH_STABLE} $${TOKEN}' < /tmp/deploy-config.php > /var/volumes/metavolcano-front/hook/deploy-config.php && php-fpm"

networks:
    php:
            #gatewayapps_proxy:
            #external: true
